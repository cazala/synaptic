<html>
	<head>
		<title>Synapse.js - Grayscale</title>
		<meta charset="UTF-8">
		<meta name="description" content="Training a neural network to solve an XOR - Synapse.js">
		<meta name="keywords" content="javascript,node.js,neural networks,lstm,long short term memory,library,synapse">
		<meta name="author" content="Juan Cazala">
		<script src='js/jquery.js'></script>
		<script src='js/synapse.js'></script>
		<style>
			html {
				box-shadow: 0 0 50px gray inset;
			}
			body { 
				font-family: "Lucida Console", Monaco, monospace;
				padding: 0px 25px;
				position: relative;
				line-height: 120%;
			}

			.title {
				text-align: center;
				color: rgb(71, 71, 71);;
				font-size: 27px;
				margin: 36px;
			}

			p {
				padding: 10px;
				font-size: 12px;
			}
			#footer {
				position: absolute;
				font-size: 11px;
				bottom: 10px;
				margin-left: 50%;
				left: -245px;
			}
			a{
				color: gray;
			}

			img, canvas {
				border: 1px solid black;
				padding: 2px;
				margin-right: 10px;
				margin-bottom: 10px;
				display: block;
			}

			.image_frame {
				display: inline-block;
				text-align: center;
				font-size: 12px;
			}

			.train {
				display: none;
			}
		</style>
		<script>

			var perceptron = null;
			var worker = null;
			var index = 0;
			var color_data = null;
			var grayscale_data = null;
			var original_data = null;
			var canvas = null;
			var context = null;
			var size = 125 * 125;
			var trial = 0;

			$(function(){
				
				perceptron = new Architect.Liquid(3,20,3,20,5);
				canvas = canvas || document.getElementById('canvas');
		        context = context || canvas.getContext('2d');
			})

			var getData = function(imageObj){

				canvas = canvas || document.getElementById('canvas');
		        context = context || canvas.getContext('2d');

		        context.drawImage(imageObj, 0, 0);

		        var imageData = context.getImageData(0, 0, 125, 125);
		        return imageData.data;
			}

			var train = function(){
				trial = 0;
				perceptron = new Architect.Perceptron(3,2,3);

		        color_data = getData(document.getElementById('colorful'));
		        grayscale_data = getData(document.getElementById('grayscale'));
 				original_data = getData(document.getElementById('original'));

 				$(".train").show();
				preview();
			}

			
			var iteration = function(){
				trial++;
				if (trial > 20)
					return;
				for (index = 0; index < size; index+=2)
				{
					px = pixel(color_data)
					perceptron.activate(px);
					perceptron.propagate(.01, pixel(grayscale_data));
				}
				preview();
			}

			var pixel = function(data){
				var y = index / 125 | 0;
				var x = index % 125;

				var red = data[((125 * y) + x) * 4];
		        var green = data[((125 * y) + x) * 4 + 1];
		        var blue = data[((125 * y) + x) * 4 + 2];

		        return [red / 255, green / 255, blue / 255];
			}

			var preview = function(){
				var imageData = context.getImageData(0, 0, 125, 125);
				for (index = 0; index < size; index++)
				{
					var px = pixel(original_data);
					var rgb = perceptron.activate(px);
					imageData.data[index * 4] = (rgb[0] )* 255;
					imageData.data[index * 4 + 1] = (rgb[1] ) * 255;
					imageData.data[index * 4 + 2] = (rgb[2] ) * 255;
				}
				context.putImageData(imageData,0,0);
				setTimeout(iteration,100);
			}

		</script>
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54879338-2', 'auto');
  ga('send', 'pageview');

</script>
	</head>
	<body>
		
		<div class='title'>Synapse.js - Grayscale</div>
		<p> In this demo, a perceptron (3 inputs, 2 hidden and 3 output neurons) will be trained to learn how to convert a picture to grayscale. During the training, the network will receive a picture as an input, and a grascale version of that same picture as an output (RGB values of their pixels). Eventually, the network will be able to take any picture as input and it will output a grayscale version of it.</p>
		<p><b>Training set:</b></p>
		<div class="image_frame"><img src='img/cat.png' id='colorful'/><span>input</span></div>
		<div class="image_frame"><img src='img/cat_bw.png' id='grayscale'/><span>output</span></div>

		<p>&nbsp;</p>
		<p> Start training: <button onclick="train();">START</button></p>
		
		<div class="train">
		<div class="image_frame"><img src='img/colorful.png' id='original'/><span>original</span></div>
		<div class="image_frame"><canvas id='canvas' width =125 height=125></canvas><span>grayscale</span></div>
		</div>
		<div id="footer"><a href='http://synapse.juancazala.com'>synapse.js</a> - javascript neural network library for node.js and the browser</div>
	</body>
</html>