var Utils = (function () {
    function Utils() {
    }
    Utils.softMax = function (outputArray) {
        // for all i ∈ array
        // sum = ∑ array[n]^e
        // i = î^e / sum
        // where the result ∑ array[0..n] = 1
        if (!outputArray.length)
            return outputArray;
        var sum = 0;
        var Amax = outputArray[0];
        for (var i = 0; i < outputArray.length; i++) {
            if (outputArray[i] < Amax)
                Amax = outputArray[i];
        }
        for (var i = 0; i < outputArray.length; i++) {
            outputArray[i] = Math.exp(outputArray[i] - Amax);
            sum += outputArray[i];
        }
        for (var i = 0; i < outputArray.length; i++)
            outputArray[i] /= sum;
        return outputArray;
    };
    Utils.softMaxDerivative = function (outputArray) {
        // http://sysmagazine.com/posts/155235/
        if (!outputArray.length)
            return outputArray;
        var sum = 0;
        for (var i = 0; i < outputArray.length; i++) {
            outputArray[i] = Math.exp(outputArray[i]);
            sum += outputArray[i];
        }
        for (var i = 0; i < outputArray.length; i++) {
            var t = outputArray[i] /= sum;
            outputArray[i] = t * (1 - t);
        }
        return outputArray;
    };
    Utils.softMaxReinforcement = function (array, temperature) {
        // Reinforcement learning
        if (temperature === void 0) { temperature = 1; }
        if (!array.length)
            return array;
        temperature = temperature || 1;
        var sum = 0;
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.exp(array[i] / temperature);
            sum += array[i];
        }
        if (sum != 0) {
            for (var i = 0; i < array.length; i++)
                array[i] /= sum;
        }
        else {
            var div = 1 / array.length;
            for (var i = 0; i < array.length; i++)
                array[i] = div;
        }
        return array;
    };
    Utils.getCosineSimilarity = function (arrayA, arrayB) {
        // http://en.wikipedia.org/wiki/Cosine_similarity
        var dotPr = 0;
        var acumA = 0, acumB = 0;
        for (var i = 0; i < arrayA.length; i++) {
            dotPr += arrayA[i] * arrayB[i];
            acumA += arrayA[i] * arrayA[i];
            acumB += arrayB[i] * arrayB[i];
        }
        return dotPr / (Math.sqrt(acumA) * Math.sqrt(acumB) + .00005);
    };
    Utils.interpolateArray = function (output_inputA, inputB, g) {
        // 3.3.2 focus by location (7)
        var gInverted = 1 - g;
        for (var i = 0; i < output_inputA.length; i++)
            output_inputA[i] = output_inputA[i] * g + gInverted * inputB[i];
        return output_inputA;
    };
    // w_sharpWn
    Utils.sharpArray = function (output, wn, Y) {
        // 3.3.2 (9)
        var sum = 0;
        for (var i = 0; i < wn.length; i++) {
            wn[i] = Math.pow(wn[i], Y);
            sum += wn[i];
        }
        // ∀ a ∈ wn → a = a^Y / sum
        if (sum != 0) {
            for (var i = 0; i < wn.length; i++)
                output[i] = wn[i] / sum;
        }
        else {
            var div = 1 / wn.length;
            for (var i = 0; i < wn.length; i++)
                output[i] = div;
        }
    };
    //wn_shift
    Utils.scalarShifting = function (wg, shiftScalar) {
        // w~ 3.3.2 (8)
        var shiftings = new Float64Array(wg.length);
        var wn = new Float64Array(wg.length);
        var intPart = shiftScalar | 0;
        var decimalPart = shiftScalar - intPart;
        shiftings[intPart % shiftings.length] = 1 - decimalPart;
        shiftings[(intPart + 1) % shiftings.length] = decimalPart;
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        return wn;
    };
    Utils.normalizeShift = function (shift) {
        var sum = 0;
        for (var i = 0; i < shift.length; i++) {
            sum += shift[i];
        }
        for (var j = 0; j < shift.length; j++) {
            shift[j] /= sum;
        }
    };
    Utils.vectorInvertedShifting = function (wg, shiftings) {
        // w~ 3.3.2 (8)
        var ret = new Float64Array(wg.length);
        var corrimientoIndex = -((shiftings.length - 1) / 2) | 0;
        var circulantMatrix = Utils.transformationMatrixCache[wg.length] || (Utils.transformationMatrixCache[wg.length] = Utils.buildCirculantMatrix(wg.length));
        for (var i = 0; i < wg.length; i++) {
            for (var x = 0; x < wg.length; x++) {
                var tmp = 0;
                for (var shift = 0; shift < shiftings.length; shift++) {
                    var matRow = i - x + corrimientoIndex + shift;
                    while (matRow < 0)
                        matRow += wg.length;
                    matRow %= wg.length;
                    tmp += wg[circulantMatrix[x][matRow]] * shiftings[shift];
                }
                ret[i] = tmp;
            }
        }
        wg.set(ret);
    };
    Utils.initRandomSoftmaxArray = function (array) {
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.random();
        }
        Utils.softMax(array);
    };
    Utils.buildCirculantMatrix = function (length, offset) {
        if (offset === void 0) { offset = 0; }
        var ret = [];
        for (var i = 0; i < length; i++) {
            var arr = new Float64Array(length);
            ret.push(arr);
            for (var n = 0; n < length; n++) {
                arr[n] = ((i + n) % length);
            }
        }
        return ret;
    };
    Utils.transformationMatrixCache = {};
    return Utils;
})();
exports.Utils = Utils;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy91dGlscy50cyJdLCJuYW1lcyI6WyJVdGlscyIsIlV0aWxzLmNvbnN0cnVjdG9yIiwiVXRpbHMuc29mdE1heCIsIlV0aWxzLnNvZnRNYXhEZXJpdmF0aXZlIiwiVXRpbHMuc29mdE1heFJlaW5mb3JjZW1lbnQiLCJVdGlscy5nZXRDb3NpbmVTaW1pbGFyaXR5IiwiVXRpbHMuaW50ZXJwb2xhdGVBcnJheSIsIlV0aWxzLnNoYXJwQXJyYXkiLCJVdGlscy5zY2FsYXJTaGlmdGluZyIsIlV0aWxzLm5vcm1hbGl6ZVNoaWZ0IiwiVXRpbHMudmVjdG9ySW52ZXJ0ZWRTaGlmdGluZyIsIlV0aWxzLmluaXRSYW5kb21Tb2Z0bWF4QXJyYXkiLCJVdGlscy5idWlsZENpcmN1bGFudE1hdHJpeCJdLCJtYXBwaW5ncyI6IkFBRUEsSUFBYSxLQUFLO0lBQWxCQSxTQUFhQSxLQUFLQTtJQXVObEJDLENBQUNBO0lBbk5RRCxhQUFPQSxHQUFkQSxVQUFpREEsV0FBY0E7UUFDN0RFLG9CQUFvQkE7UUFDcEJBLHFCQUFxQkE7UUFDckJBLGdCQUFnQkE7UUFDaEJBLHFDQUFxQ0E7UUFFckNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO1FBRTVDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVaQSxJQUFJQSxJQUFJQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMxQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsV0FBV0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUNBLEVBQUVBLENBQUFBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUFDQSxJQUFJQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsREEsQ0FBQ0E7UUFJREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsV0FBV0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDNUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1lBQ2pEQSxHQUFHQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFFREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsV0FBV0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUE7WUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0E7UUFFbkVBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO0lBQ3JCQSxDQUFDQTtJQUVNRix1QkFBaUJBLEdBQXhCQSxVQUEyREEsV0FBY0E7UUFDdkVHLEFBQ0FBLHVDQUR1Q0E7UUFDdkNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO1FBRTVDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUdaQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUM1Q0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FB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QUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLEdBQUdBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLENBQUNBO1FBRURBLEFBQ0FBLDJCQUQyQkE7UUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUM5REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDeEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUN0REEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFFRFAsVUFBVUE7SUFDSEEsb0JBQWNBLEdBQXJCQSxVQUFzQkEsRUFBMEJBLEVBQUVBLFdBQW1CQTtRQUNuRVEsQUFDQUEsZUFEZUE7WUFDWEEsU0FBU0EsR0FBR0EsSUFBSUEsWUFBWUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDNUNBLElBQUlBLEVBQUVBLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRXJDQSxJQUFJQSxPQUFPQSxHQUFHQSxXQUFXQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUM5QkEsSUFBSUEsV0FBV0EsR0FBR0EsV0FBV0EsR0FBR0EsT0FBT0EsQ0FBQ0E7UUFFeENBLFNBQVNBLENBQUNBLE9BQU9BLEdBQUdBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLFdBQVdBLENBQUNBO1FBQ3hEQSxTQUFTQSxDQUFDQSxDQUFDQSxPQUFPQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQTtRQUcxREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDbkNBLElBQUlBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO2dCQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2RBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLFNBQVNBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNoRUEsSUFBSUE7b0JBQ0ZBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQzFEQSxDQUFDQTtZQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNmQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQTtJQUNaQSxDQUFDQTtJQUVNUixvQkFBY0EsR0FBckJBLFVBQXNCQSxLQUFtQkE7UUFDdkNTLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO1FBQ1pBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3RDQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsQkEsQ0FBQ0E7UUFDREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdENBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBO1FBQ2xCQSxDQUFDQTtJQUNIQSxDQUFDQTtJQUVNVCw0QkFBc0JBLEdBQTdCQSxVQUE4QkEsRUFBZ0JBLEVBQUVBLFNBQWlDQTtRQUMvRVUsZUFBZUE7UUFHZkEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsWUFBWUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFdENBLElBQUlBLGdCQUFnQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFekRBLElBQUlBLGVBQWVBLEdBQUdBLEtBQUtBLENBQUNBLHlCQUF5QkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EseUJBQXlCQSxDQUFDQSxFQUFFQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxvQkFBb0JBLENBQUNBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBRXpKQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNuQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7Z0JBQ25DQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFFWkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsR0FBR0EsU0FBU0EsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsRUFBRUEsRUFBRUEsQ0FBQ0E7b0JBRXREQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxnQkFBZ0JBLEdBQUdBLEtBQUtBLENBQUNBO29CQUU5Q0EsT0FBT0EsTUFBTUEsR0FBR0EsQ0FBQ0E7d0JBQ2ZBLE1BQU1BLElBQUlBLEVBQUVBLENBQUNBLE1BQU1BLENBQUNBO29CQUV0QkEsTUFBTUEsSUFBSUEsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7b0JBRXBCQSxHQUFHQSxJQUFJQSxFQUFFQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxHQUFHQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtnQkFDM0RBLENBQUNBO2dCQUVEQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtZQUNmQSxDQUFDQTtRQUVIQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNkQSxDQUFDQTtJQUVNViw0QkFBc0JBLEdBQTdCQSxVQUE4QkEsS0FBbUJBO1FBQy9DVyxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUN0Q0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDM0JBLENBQUNBO1FBRURBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUVNWCwwQkFBb0JBLEdBQTNCQSxVQUE0QkEsTUFBY0EsRUFBRUEsTUFBa0JBO1FBQWxCWSxzQkFBa0JBLEdBQWxCQSxVQUFrQkE7UUFDNURBLElBQUlBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBO1FBRWJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2hDQSxJQUFJQSxHQUFHQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUNuQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDZEEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7Z0JBQ2hDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUM5QkEsQ0FBQ0E7UUFDSEEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFwTk1aLCtCQUF5QkEsR0FBeUNBLEVBQUVBLENBQUNBO0lBcU45RUEsWUFBQ0E7QUFBREEsQ0F2TkEsQUF1TkNBLElBQUE7QUF2TlksYUFBSyxHQUFMLEtBdU5aLENBQUEiLCJmaWxlIjoic3JjL3V0aWxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN5bmFwdGljID0gcmVxdWlyZSgnLi9zeW5hcHRpYycpO1xuXG5leHBvcnQgY2xhc3MgVXRpbHMge1xuICBcbiAgc3RhdGljIHRyYW5zZm9ybWF0aW9uTWF0cml4Q2FjaGU6IHsgW2luZGV4OiBudW1iZXJdIDogRmxvYXQ2NEFycmF5W10gfSA9IHt9O1xuICBcbiAgc3RhdGljIHNvZnRNYXg8VCBleHRlbmRzIFN5bmFwdGljLklOdW1lcmljQXJyYXk+KG91dHB1dEFycmF5OiBUKTogVCB7XG4gICAgLy8gZm9yIGFsbCBpIOKIiCBhcnJheVxuICAgIC8vIHN1bSA9IOKIkSBhcnJheVtuXV5lXG4gICAgLy8gaSA9IMOuXmUgLyBzdW1cbiAgICAvLyB3aGVyZSB0aGUgcmVzdWx0IOKIkSBhcnJheVswLi5uXSA9IDFcblxuICAgIGlmICghb3V0cHV0QXJyYXkubGVuZ3RoKSByZXR1cm4gb3V0cHV0QXJyYXk7XG5cbiAgICB2YXIgc3VtID0gMDtcblxuICAgIHZhciBBbWF4ID0gb3V0cHV0QXJyYXlbMF07XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRwdXRBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYob3V0cHV0QXJyYXlbaV0gPCBBbWF4KSBBbWF4ID0gb3V0cHV0QXJyYXlbaV07XG4gICAgfVxuICAgIFxuXG4gICAgLy8gc3VtID0g4oiRIGFycmF5W25dXmVcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG91dHB1dEFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBvdXRwdXRBcnJheVtpXSA9IE1hdGguZXhwKG91dHB1dEFycmF5W2ldIC0gQW1heCk7XG4gICAgICBzdW0gKz0gb3V0cHV0QXJyYXlbaV07XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRwdXRBcnJheS5sZW5ndGg7IGkrKykgb3V0cHV0QXJyYXlbaV0gLz0gc3VtO1xuXG4gICAgcmV0dXJuIG91dHB1dEFycmF5O1xuICB9XG5cbiAgc3RhdGljIHNvZnRNYXhEZXJpdmF0aXZlPFQgZXh0ZW5kcyBTeW5hcHRpYy5JTnVtZXJpY0FycmF5PihvdXRwdXRBcnJheTogVCk6IFQge1xuICAgIC8vIGh0dHA6Ly9zeXNtYWdhemluZS5jb20vcG9zdHMvMTU1MjM1L1xuICAgIGlmICghb3V0cHV0QXJyYXkubGVuZ3RoKSByZXR1cm4gb3V0cHV0QXJyYXk7XG5cbiAgICB2YXIgc3VtID0gMDtcblxuICAgIC8vIHN1bSA9IOKIkSBhcnJheVtuXV5lXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRwdXRBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgb3V0cHV0QXJyYXlbaV0gPSBNYXRoLmV4cChvdXRwdXRBcnJheVtpXSk7XG4gICAgICBzdW0gKz0gb3V0cHV0QXJyYXlbaV07XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRwdXRBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHQgPSBvdXRwdXRBcnJheVtpXSAvPSBzdW07XG4gICAgICBcbiAgICAgIG91dHB1dEFycmF5W2ldID0gdCAqICgxIC0gdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dEFycmF5O1xuICB9XG5cbiAgc3RhdGljIHNvZnRNYXhSZWluZm9yY2VtZW50PFQgZXh0ZW5kcyBTeW5hcHRpYy5JTnVtZXJpY0FycmF5PihhcnJheTogVCwgdGVtcGVyYXR1cmUgPSAxKTogVCB7XG4gICAgLy8gUmVpbmZvcmNlbWVudCBsZWFybmluZ1xuXG4gICAgaWYgKCFhcnJheS5sZW5ndGgpIHJldHVybiBhcnJheTtcblxuICAgIHRlbXBlcmF0dXJlID0gdGVtcGVyYXR1cmUgfHwgMTtcblxuICAgIHZhciBzdW0gPSAwO1xuXG4gICAgLy8gc3VtID0g4oiRIGFycmF5W25dXmVcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBhcnJheVtpXSA9IE1hdGguZXhwKGFycmF5W2ldIC8gdGVtcGVyYXR1cmUpO1xuICAgICAgc3VtICs9IGFycmF5W2ldO1xuICAgIH1cblxuICAgIGlmIChzdW0gIT0gMCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgYXJyYXlbaV0gLz0gc3VtO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZGl2ID0gMSAvIGFycmF5Lmxlbmd0aDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIGFycmF5W2ldID0gZGl2O1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG5cbiAgc3RhdGljIGdldENvc2luZVNpbWlsYXJpdHkoYXJyYXlBOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBhcnJheUI6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpOiBudW1iZXIge1xuICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29zaW5lX3NpbWlsYXJpdHlcbiAgICB2YXIgZG90UHIgPSAwO1xuXG4gICAgdmFyIGFjdW1BID0gMCwgYWN1bUIgPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheUEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRvdFByICs9IGFycmF5QVtpXSAqIGFycmF5QltpXTtcbiAgICAgIGFjdW1BICs9IGFycmF5QVtpXSAqIGFycmF5QVtpXTtcbiAgICAgIGFjdW1CICs9IGFycmF5QltpXSAqIGFycmF5QltpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG90UHIgLyAoTWF0aC5zcXJ0KGFjdW1BKSAqIE1hdGguc3FydChhY3VtQikgKyAuMDAwMDUpO1xuICB9XG5cbiAgc3RhdGljIGludGVycG9sYXRlQXJyYXkob3V0cHV0X2lucHV0QTogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgaW5wdXRCOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBnKSB7XG4gICAgLy8gMy4zLjIgZm9jdXMgYnkgbG9jYXRpb24gKDcpXG4gICAgdmFyIGdJbnZlcnRlZCA9IDEgLSBnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0X2lucHV0QS5sZW5ndGg7IGkrKylcbiAgICAgIG91dHB1dF9pbnB1dEFbaV0gPSBvdXRwdXRfaW5wdXRBW2ldICogZyArIGdJbnZlcnRlZCAqIGlucHV0QltpXTtcbiAgICByZXR1cm4gb3V0cHV0X2lucHV0QTtcbiAgfVxuICBcbiAgLy8gd19zaGFycFduXG4gIHN0YXRpYyBzaGFycEFycmF5KG91dHB1dDogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgd246IFN5bmFwdGljLklOdW1lcmljQXJyYXksIFk6IG51bWJlcikge1xuICAgIC8vIDMuMy4yICg5KVxuICAgIHZhciBzdW0gPSAwO1xuXG4gICAgLy8g4oiAIGEg4oiIIHduIOKGkiBhID0gYV5ZXG4gICAgLy8gc3VtID0g4oiRIGFeWSBcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHduW2ldID0gTWF0aC5wb3cod25baV0sIFkpO1xuICAgICAgc3VtICs9IHduW2ldO1xuICAgIH1cblxuICAgIC8vIOKIgCBhIOKIiCB3biDihpIgYSA9IGFeWSAvIHN1bVxuICAgIGlmIChzdW0gIT0gMCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykgb3V0cHV0W2ldID0gd25baV0gLyBzdW07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBkaXYgPSAxIC8gd24ubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykgb3V0cHV0W2ldID0gZGl2O1xuICAgIH1cbiAgfVxuICBcbiAgLy93bl9zaGlmdFxuICBzdGF0aWMgc2NhbGFyU2hpZnRpbmcod2c6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIHNoaWZ0U2NhbGFyOiBudW1iZXIpIHtcbiAgICAvLyB3fiAzLjMuMiAoOClcbiAgICB2YXIgc2hpZnRpbmdzID0gbmV3IEZsb2F0NjRBcnJheSh3Zy5sZW5ndGgpO1xuICAgIHZhciB3biA9IG5ldyBGbG9hdDY0QXJyYXkod2cubGVuZ3RoKTtcblxuICAgIHZhciBpbnRQYXJ0ID0gc2hpZnRTY2FsYXIgfCAwO1xuICAgIHZhciBkZWNpbWFsUGFydCA9IHNoaWZ0U2NhbGFyIC0gaW50UGFydDtcblxuICAgIHNoaWZ0aW5nc1tpbnRQYXJ0ICUgc2hpZnRpbmdzLmxlbmd0aF0gPSAxIC0gZGVjaW1hbFBhcnQ7XG4gICAgc2hpZnRpbmdzWyhpbnRQYXJ0ICsgMSkgJSBzaGlmdGluZ3MubGVuZ3RoXSA9IGRlY2ltYWxQYXJ0O1xuXG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYWN1bSA9IDA7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHduLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICgoaSAtIGopIDwgMClcbiAgICAgICAgICBhY3VtICs9IHdnW2pdICogc2hpZnRpbmdzW3NoaWZ0aW5ncy5sZW5ndGggLSBNYXRoLmFicyhpIC0gaildO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgYWN1bSArPSB3Z1tqXSAqIHNoaWZ0aW5nc1soaSAtIGopICUgc2hpZnRpbmdzLmxlbmd0aF07XG4gICAgICB9XG4gICAgICB3bltpXSA9IGFjdW07XG4gICAgfVxuXG4gICAgcmV0dXJuIHduO1xuICB9XG5cbiAgc3RhdGljIG5vcm1hbGl6ZVNoaWZ0KHNoaWZ0OiBGbG9hdDY0QXJyYXkpIHtcbiAgICB2YXIgc3VtID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNoaWZ0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdW0gKz0gc2hpZnRbaV07XG4gICAgfVxuICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2hpZnQubGVuZ3RoOyBqKyspIHtcbiAgICAgIHNoaWZ0W2pdIC89IHN1bTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgdmVjdG9ySW52ZXJ0ZWRTaGlmdGluZyh3ZzogRmxvYXQ2NEFycmF5LCBzaGlmdGluZ3M6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpIHtcbiAgICAvLyB3fiAzLjMuMiAoOClcblxuICAgIFxuICAgIHZhciByZXQgPSBuZXcgRmxvYXQ2NEFycmF5KHdnLmxlbmd0aCk7XG5cbiAgICB2YXIgY29ycmltaWVudG9JbmRleCA9IC0oKHNoaWZ0aW5ncy5sZW5ndGggLSAxKSAvIDIpIHwgMDtcblxuICAgIHZhciBjaXJjdWxhbnRNYXRyaXggPSBVdGlscy50cmFuc2Zvcm1hdGlvbk1hdHJpeENhY2hlW3dnLmxlbmd0aF0gfHwgKFV0aWxzLnRyYW5zZm9ybWF0aW9uTWF0cml4Q2FjaGVbd2cubGVuZ3RoXSA9IFV0aWxzLmJ1aWxkQ2lyY3VsYW50TWF0cml4KHdnLmxlbmd0aCkpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3Zy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3Zy5sZW5ndGg7IHgrKykge1xuICAgICAgICB2YXIgdG1wID0gMDtcblxuICAgICAgICBmb3IgKHZhciBzaGlmdCA9IDA7IHNoaWZ0IDwgc2hpZnRpbmdzLmxlbmd0aDsgc2hpZnQrKykge1xuXG4gICAgICAgICAgdmFyIG1hdFJvdyA9IGkgLSB4ICsgY29ycmltaWVudG9JbmRleCArIHNoaWZ0O1xuXG4gICAgICAgICAgd2hpbGUgKG1hdFJvdyA8IDApXG4gICAgICAgICAgICBtYXRSb3cgKz0gd2cubGVuZ3RoO1xuXG4gICAgICAgICAgbWF0Um93ICU9IHdnLmxlbmd0aDtcblxuICAgICAgICAgIHRtcCArPSB3Z1tjaXJjdWxhbnRNYXRyaXhbeF1bbWF0Um93XV0gKiBzaGlmdGluZ3Nbc2hpZnRdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0W2ldID0gdG1wO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgd2cuc2V0KHJldCk7XG4gIH1cblxuICBzdGF0aWMgaW5pdFJhbmRvbVNvZnRtYXhBcnJheShhcnJheTogRmxvYXQ2NEFycmF5KTogdm9pZCB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXlbaV0gPSBNYXRoLnJhbmRvbSgpO1xuICAgIH1cblxuICAgIFV0aWxzLnNvZnRNYXgoYXJyYXkpO1xuICB9XG5cbiAgc3RhdGljIGJ1aWxkQ2lyY3VsYW50TWF0cml4KGxlbmd0aDogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciA9IDApOiBGbG9hdDY0QXJyYXlbXSB7XG4gICAgdmFyIHJldCA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGFyciA9IG5ldyBGbG9hdDY0QXJyYXkobGVuZ3RoKTtcbiAgICAgIHJldC5wdXNoKGFycik7XG4gICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGxlbmd0aDsgbisrKSB7XG4gICAgICAgIGFycltuXSA9ICgoaSArIG4pICUgbGVuZ3RoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=