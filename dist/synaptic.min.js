!function t(e,i,n){function r(a,s){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!s&&h)return h(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,i){var n=t("./architect/Hopfield"),r=t("./architect/LSTM"),o=t("./architect/Liquid"),a=t("./architect/Perceptron"),s=t("./architect/NTM");i.LSTM=r.LSTM,i.Liquid=o.Liquid,i.Hopfield=n.Hopfield,i.Perceptron=a.Perceptron,i.NTM=s.NTM},{"./architect/Hopfield":2,"./architect/LSTM":3,"./architect/Liquid":4,"./architect/NTM":5,"./architect/Perceptron":6}],2:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("../network"),o=t("../trainer"),a=t("../layer"),s=function(t){function e(e){var i=new a.Layer(e),n=new a.Layer(e);i.project(n,a.Layer.connectionType.ALL_TO_ALL),t.call(this,{input:i,hidden:[],output:n}),this.trainer=new o.Trainer(this)}return n(e,t),e.prototype.learn=function(t){var e=[];for(var i in t)e.push({input:t[i],output:t[i]});return this.trainer.train(e,{iterations:5e5,error:5e-5,rate:1})},e.prototype.feed=function(t){var e=this.activate(t),i=[];for(var n in e)i[n]=e[n]>.5?1:0;return i},e}(r.Network);i.Hopfield=s},{"../layer":7,"../network":8,"../trainer":13}],3:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("../network"),o=t("../trainer"),a=t("../layer"),s=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];if(e.length<3)throw"Error: not enough layers (minimum 3) !!";var n=e.pop(),r={peepholes:a.Layer.connectionType.ALL_TO_ALL,hiddentohidden:!1,outtohidden:!1,outtogates:!1,intoout:!0};if("number"!=typeof n){var s=e.pop();n.hasOwnProperty("peepholes")&&(r.peepholes=n.peepholes),n.hasOwnProperty("hiddentohidden")&&(r.hiddentohidden=n.hiddentohidden),n.hasOwnProperty("outtohidden")&&(r.outtohidden=n.outtohidden),n.hasOwnProperty("outtogates")&&(r.outtogates=n.outtogates),n.hasOwnProperty("intoout")&&(r.intoout=n.intoout)}else var s=n;var h=e.shift(),c=e,u=new a.Layer(h),p=[],l=new a.Layer(s),f=null;for(var v in c){var d=c[v],y=new a.Layer(d).set({bias:1}),g=new a.Layer(d).set({bias:1}),m=new a.Layer(d),w=new a.Layer(d).set({bias:1});p.push(y),p.push(g),p.push(m),p.push(w);var L=u.project(m);if(u.project(y),u.project(g),u.project(w),null!=f){var T=f.project(m);f.project(y),f.project(g),f.project(w)}var b=m.project(l),_=m.project(m);r.hiddentohidden&&m.project(m,a.Layer.connectionType.ALL_TO_ELSE),r.outtohidden&&l.project(m),r.outtogates&&(l.project(y),l.project(w),l.project(g)),m.project(y,r.peepholes),m.project(g,r.peepholes),m.project(w,r.peepholes),y.gate(L,a.Layer.gateType.INPUT),g.gate(_,a.Layer.gateType.ONE_TO_ONE),w.gate(b,a.Layer.gateType.OUTPUT),null!=f&&y.gate(T,a.Layer.gateType.INPUT),f=m}r.intoout&&u.project(l),t.call(this,{input:u,hidden:p,output:l}),this.trainer=new o.Trainer(this)}return n(e,t),e}(r.Network);i.LSTM=s},{"../layer":7,"../network":8,"../trainer":13}],4:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("../network"),o=t("../trainer"),a=t("../layer"),s=function(t){function e(e,i,n,r,s){for(var h=new a.Layer(e),c=new a.Layer(i),u=new a.Layer(n),p=c.neurons(),l=[],f=0;r>f;f++){var v=Math.random()*p.length|0,d=Math.random()*p.length|0,y=p[v].project(p[d]);l.push(y)}for(var g=0;s>g;g++){var m=Math.random()*p.length|0,w=Math.random()*l.length|0;p[m].gate(l[w])}h.project(c),c.project(u),t.call(this,{input:h,hidden:[c],output:u}),this.trainer=new o.Trainer(this)}return n(e,t),e}(r.Network);i.Liquid=s},{"../layer":7,"../network":8,"../trainer":13}],5:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("../network"),o=t("../trainer"),a=t("../layer"),s=t("../squash"),h=t("../utils"),c=t("../softmaxLayer"),u=h.Utils,p=function(t){function e(e,i,n,r,s,h){t.call(this),this.heads=new Array,this.dirty=!1,this.trainer=new o.Trainer(this),this.blocks=n,this.blockWidth=r,this.data=new Array(this.blocks);for(var c=0;c<this.data.length;c++)this.data[c]=new Float64Array(r);this.clean();var u=e+s*n;this.inputValues=new Float64Array(u),this.layers.input=this.inputLayer=new a.Layer(u),this.hiddenLayer=new a.Layer(h),this.layers.output=this.outputLayer=new a.Layer(i),this.inputLayer.project(this.hiddenLayer,a.Layer.connectionType.ALL_TO_ALL),this.hiddenLayer.project(this.outputLayer,a.Layer.connectionType.ALL_TO_ALL);for(var p=e-1,l=0;s>l;l++)this.addHead(this.inputValues.subarray(p,p+n)),p+=n;this.optimized=!1}return n(e,t),e.prototype.clean=function(){for(var t=0;t<this.blocks;t++)u.initRandomSoftmaxArray(this.data[t]);this.dirty=!1},e.prototype.activate=function(t){return this.inputValues.set(t),this.inputLayer.activate(this.inputValues),this.hiddenLayer.activate(),this.doTimeStep(),this.outputLayer.activate()},e.prototype.propagate=function(t,e){this.outputLayer.propagate(t,e);for(var i=this.heads.length-1;i>=0;i--)this.heads[i].shiftingLayer&&this.heads[i].shiftingLayer.propagate(t),this.heads[i].layer.propagate(t);this.hiddenLayer.propagate(t),this.dirty=!0},e.prototype.addHead=function(t){var e=new l(this,t);return this.heads.push(e),e},e.prototype.doTimeStep=function(){var t=this;this.heads.forEach(function(t,e){t.doTimeStep()}),this.heads.forEach(function(e,i){t.doErase(e.w_weightings,e.eraseGate)}),this.heads.forEach(function(e,i){t.doAdd(e.w_weightings,e.addGate)})},e.prototype.doAdd=function(t,e){for(var i=0;i<this.blocks;i++)for(var n=this.data[i],r=0;r<this.blockWidth;r++)n[r]+=e[i]*t[r]},e.prototype.doErase=function(t,e){for(var i=0;i<this.blocks;i++)for(var n=this.data[i],r=0;r<this.blockWidth;r++)n[r]*=1-e[i]*t[r]},e}(r.Network);i.NTM=p;var l=function(){function t(e,i){this.s_shiftingValue=null,this.prevFocus=1,this.memory=e,this.wc_focusedWeights=new Float64Array(this.memory.blocks),this.w_weightings=new Float64Array(this.memory.blocks),u.initRandomSoftmaxArray(this.w_weightings),this.shiftLength=3,this.k_keys=new Float64Array(this.memory.blockWidth),this.ß_keyStrength=0,this.eraseGate=new Float64Array(this.memory.blocks),this.addGate=new Float64Array(this.memory.blocks),this.readVector=i||new Float64Array(this.memory.blocks),this.layer=new a.Layer(this.memory.blockWidth+3*this.memory.blocks+t.ADDITIONAL_INPUT_VALUES,"NTM: Head layer"),this.memory.hiddenLayer.project(this.layer,a.Layer.connectionType.ALL_TO_ALL),this.layer.project(this.memory.outputLayer,a.Layer.connectionType.ALL_TO_ALL),this.shiftingLayer=new c.SoftMaxLayer(this.shiftLength,"NTM: Shifting layer"),this.memory.hiddenLayer.project(this.shiftingLayer,a.Layer.connectionType.ALL_TO_ALL),this.shiftingLayer.project(this.memory.hiddenLayer,a.Layer.connectionType.ALL_TO_ALL),this.s_shiftingVector=this.shiftingLayer.currentActivation}return t.prototype.readParams=function(t){this.ß_keyStrength=t[0],this.g_interpolation=t[1],this.Y_focus=t[2]+1;for(var e=3,i=0;i<this.k_keys.length;i++)this.k_keys[i]=this.layer.list[i+e].activation;e+=this.k_keys.length;for(var i=0;i<this.addGate.length;i++)this.addGate[i]=this.layer.list[i+e].activation;e+=this.addGate.length;for(var i=0;i<this.eraseGate.length;i++)this.eraseGate[i]=s.LOGISTIC(this.layer.list[i+e].activation);for(var n=this.memory.data,r=0;r<n.length;r++)this.wc_focusedWeights[r]=u.getCosineSimilarity(n[r],this.k_keys)*this.ß_keyStrength;u.softMax(this.wc_focusedWeights),u.interpolateArray(this.wc_focusedWeights,this.w_weightings,this.g_interpolation),u.vectorInvertedShifting(this.wc_focusedWeights,this.s_shiftingVector),u.sharpArray(this.w_weightings,this.wc_focusedWeights,this.Y_focus),u.softMax(this.w_weightings)},t.prototype.doShiftings=function(){u.softMax(this.s_shiftingVector),u.vectorInvertedShifting(this.wc_focusedWeights,this.s_shiftingVector)},t.prototype.doTimeStep=function(){var t=this.layer.activate();this.shiftingLayer&&this.shiftingLayer.activate(),this.readParams(t);for(var e=0;e<this.memory.blocks;e++){this.readVector[e]=0;for(var i=0;i<this.memory.blockWidth;i++)this.readVector[e]+=this.memory.data[e][i]*this.w_weightings[e]}},t.ADDITIONAL_INPUT_VALUES=3,t}();i.Head=l},{"../layer":7,"../network":8,"../softmaxLayer":10,"../squash":11,"../trainer":13,"../utils":14}],6:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("../network"),o=t("../trainer"),a=t("../layer"),s=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];if(e.length<3)throw"Error: not enough layers (minimum 3) !!";var n=e.shift(),r=e.pop(),s=e,h=new a.Layer(n),c=[],u=new a.Layer(r),p=h;for(var l in s){var f=s[l],v=new a.Layer(f);c.push(v),p.project(v),p=v}p.project(u),t.call(this,{input:h,hidden:c,output:u}),this.trainer=new o.Trainer(this)}return n(e,t),e}(r.Network);i.Perceptron=s},{"../layer":7,"../network":8,"../trainer":13}],7:[function(t,e,i){var n=t("./neuron"),r=t("./network"),o=function(){function t(t,e){for(this.optimizable=!0,this.list=[],this.label=null,this.connectedto=[],this.size=0,this.size=0|t,this.list=[],this.label=e||null,this.connectedto=[],this.currentActivation=new Float64Array(t);t--;){var i=new n.Neuron;this.list.push(i)}}return t.prototype.activate=function(t){this.currentActivation.length!=this.list.length&&(this.currentActivation=new Float64Array(this.list.length));var e=0;if("undefined"!=typeof t){if(t.length!=this.size)throw"INPUT size and LAYER size must be the same to activate!";for(var i in this.list)this.currentActivation[e++]=this.list[i].activate(t[i])}else for(var i in this.list)this.currentActivation[e++]=this.list[i].activate();return this.currentActivation},t.prototype.propagate=function(t,e){if("undefined"!=typeof e){if(e.length!=this.size)throw"TARGET size and LAYER size must be the same to propagate!";for(var i=this.list.length-1;i>=0;i--){var n=this.list[i];n.propagate(t,e[i])}}else for(var i=this.list.length-1;i>=0;i--){var n=this.list[i];n.propagate(t)}},t.prototype.project=function(e,i,n){if(e instanceof r.Network&&(e=e.layers.input),!(e instanceof t))throw"Invalid argument, you can only project connections to LAYERS and NETWORKS!";return this.connected(e)?void 0:new t.LayerConnection(this,e,i,n)},t.prototype.gate=function(e,i){if(i==t.gateType.INPUT){if(e.to.size!=this.size)throw"GATER layer and CONNECTION.TO layer must be the same size in order to gate!";for(var n in e.to.list){var r=e.to.list[n],o=this.list[n];for(var a in r.connections.inputs){var s=r.connections.inputs[a];s.ID in e.connections&&o.gate(s)}}}else if(i==t.gateType.OUTPUT){if(e.from.size!=this.size)throw"GATER layer and CONNECTION.FROM layer must be the same size in order to gate!";for(var n in e.from.list){var r=e.from.list[n],o=this.list[n];for(var h in r.connections.projected){var s=r.connections.projected[h];s.ID in e.connections&&o.gate(s)}}}else if(i==t.gateType.ONE_TO_ONE){if(e.size!=this.size)throw"The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!";for(var n in e.list){var o=this.list[n],s=e.list[n];o.gate(s)}}e.gatedfrom.push({layer:this,type:i})},t.prototype.selfconnected=function(){for(var t in this.list){var e=this.list[t];if(!e.selfconnected())return!1}return!0},t.prototype.connected=function(e){var i=0;for(var n in this.list)for(var r in e.list){var o=this.list[n],a=e.list[r],s=o.connected(a);s&&"projected"==s.type&&i++}if(i==this.size*e.size)return t.connectionType.ALL_TO_ALL;i=0;for(var h in this.list){var o=this.list[h],a=e.list[h],s=o.connected(a);s&&"projected"==s.type&&i++}return i==this.size?t.connectionType.ONE_TO_ONE:void 0},t.prototype.clear=function(){for(var t in this.list){var e=this.list[t];e.clear()}},t.prototype.reset=function(){for(var t in this.list){var e=this.list[t];e.reset()}},t.prototype.neurons=function(){return this.list},t.prototype.add=function(t){t=t||new t.Neuron,this.neurons[t.ID]=t,this.list.push(t),this.size++},t.prototype.set=function(t){t=t||{};for(var e in this.list){var i=this.list[e];t.label&&(i.label=t.label+"_"+i.ID),t.squash&&(i.squash=t.squash),t.bias&&(i.bias=t.bias)}return this},t}();i.Layer=o;var o;!function(t){function e(){return t.layerQty++}t.layerQty=0,t.uid=e,t.connectionType={ALL_TO_ALL:"ALL TO ALL",ONE_TO_ONE:"ONE TO ONE",ALL_TO_ELSE:"ALL TO ELSE"},t.gateType={INPUT:"INPUT",OUTPUT:"OUTPUT",ONE_TO_ONE:"ONE TO ONE"};var i=function(){function i(i,n,r,o){if(this.ID=e(),this.selfconnection=!1,this.size=0,this.gatedfrom=[],this.from=i,this.to=n,this.selfconnection=n==i,this.type=r,this.connections={},this.list=[],this.size=0,this.gatedfrom=[],"undefined"==typeof this.type&&(this.type=i==n?t.connectionType.ONE_TO_ONE:t.connectionType.ALL_TO_ALL),this.type==t.connectionType.ALL_TO_ALL||this.type==t.connectionType.ALL_TO_ELSE)for(var a in this.from.list)for(var s in this.to.list){var h=this.from.list[a],c=this.to.list[s];if(this.type!=t.connectionType.ALL_TO_ELSE||h!=c){var u=h.project(c,o);this.connections[u.ID]=u,this.size=this.list.push(u)}}else if(this.type==t.connectionType.ONE_TO_ONE)for(var p in this.from.list){var h=this.from.list[p],c=this.to.list[p],u=h.project(c,o);this.connections[u.ID]=u,this.size=this.list.push(u)}i.connectedto.push(this)}return i}();t.LayerConnection=i}(o=i.Layer||(i.Layer={}))},{"./network":8,"./neuron":9}],8:[function(t,e,i){var n=t("./layer"),r=t("./squash"),o=t("./neuron"),a=function(){function t(t){this.optimized=null,this.layers={input:null,hidden:{},output:null},"undefined"!=typeof t&&(this.layers=t||{input:null,hidden:[],output:null})}return t.prototype.activate=function(t){if(this.optimized===!1){this.layers.input.activate(t);for(var e in this.layers.hidden)this.layers.hidden[e].activate();return this.layers.output.activate()}return null==this.optimized&&this.optimize(),this.optimized.activate(t)},t.prototype.propagate=function(t,e){if(this.optimized===!1){this.layers.output.propagate(t,e);var i=[];for(var n in this.layers.hidden)i.push(this.layers.hidden[n]);i.reverse();for(var n in i)i[n].propagate(t)}else null==this.optimized&&this.optimize(),this.optimized.propagate(t,e)},t.prototype.project=function(e,i,r){if(this.optimized&&this.optimized.reset(),e instanceof t)return this.layers.output.project(e.layers.input,i,r);if(e instanceof n.Layer)return this.layers.output.project(e,i,r);throw"Invalid argument, you can only project connections to LAYERS and NETWORKS!"},t.prototype.gate=function(t,e){this.optimized&&this.optimized.reset(),this.layers.output.gate(t,e)},t.prototype.clear=function(){this.restore();var t=this.layers.input,e=this.layers.output;t.clear();for(var i in this.layers.hidden){var n=this.layers.hidden[i];n.clear()}e.clear(),this.optimized&&this.optimized.reset()},t.prototype.reset=function(){this.restore();var t=this.layers.input,e=this.layers.output;t.reset();for(var i in this.layers.hidden){var n=this.layers.hidden[i];n.reset()}e.reset(),this.optimized&&this.optimized.reset()},t.prototype.optimize=function(){var t=this,e={},i=this.neurons();for(var n in i){var r=i[n].neuron,o=i[n].layer;e=r.optimize(e,o)}for(var n in e.propagation_sentences)e.propagation_sentences[n].reverse();e.propagation_sentences.reverse();var a="";a+="var F = Float64Array ? new Float64Array("+e.memory+") : []; ";for(var n in e.variables)a+="F["+e.variables[n].id+"] = "+(e.variables[n].value||0)+"; ";a+="var activate = function(input){\n",a+="influences = [];";for(var n in e.inputs)a+="F["+e.inputs[n]+"] = input["+n+"]; ";for(var s in e.activation_sentences)if(e.activation_sentences[s].length>0)for(var h in e.activation_sentences[s])a+=e.activation_sentences[s][h].join(" "),a+=e.trace_sentences[s][h].join(" ");a+=" var output = []; ";for(var n in e.outputs)a+="output["+n+"] = F["+e.outputs[n]+"]; ";a+="return output; }; ",a+="var propagate = function(rate, target){\n",a+="F["+e.variables.rate.id+"] = rate; ";for(var n in e.targets)a+="F["+e.targets[n]+"] = target["+n+"]; ";for(var s in e.propagation_sentences)for(var h in e.propagation_sentences[s])a+=e.propagation_sentences[s][h].join(" ")+" ";a+=" };\n",a+="var ownership = function(memoryBuffer){\nF = memoryBuffer;\nthis.memory = F;\n};\n",a+="return {\nmemory: F,\nactivate: activate,\npropagate: propagate,\nownership: ownership\n};",a=a.split(";").join(";\n");var c=new Function(a),u=c();u.data={variables:e.variables,activate:e.activation_sentences,propagate:e.propagation_sentences,trace:e.trace_sentences,inputs:e.inputs,outputs:e.outputs,check_activation:this.activate,check_propagation:this.propagate},u.reset=function(){t.optimized&&(t.optimized=null,t.activate=u.data.check_activation,t.propagate=u.data.check_propagation)},this.optimized=u,this.activate=u.activate,this.propagate=u.propagate},t.prototype.restore=function(){if(this.optimized){var t=this.optimized,e=function(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];var n=e.shift(),r=e.pop(),o=r+"_";for(var a in e)o+=e[a]+"_";o+=n.ID;var s=t.memory,h=t.data.variables;return o in h?s[h[o].id]:0},i=this.neurons();for(var n in i){var r=i[n].neuron;r.state=e(r,"state"),r.old=e(r,"old"),r.activation=e(r,"activation"),r.bias=e(r,"bias");for(var o in r.trace.elegibility)r.trace.elegibility[o]=e(r,"trace","elegibility",o);for(var a in r.trace.extended)for(var o in r.trace.extended[a])r.trace.extended[a][o]=e(r,"trace","extended",a,o)}for(var n in i){var r=i[n].neuron;for(var s in r.connections.projected){var h=r.connections.projected[s];h.weight=e(h,"weight"),h.gain=e(h,"gain")}}}},t.prototype.neurons=function(){var t=[],e=this.layers.input.neurons(),i=this.layers.output.neurons();for(var n in e)t.push({neuron:e[n],layer:"input"});for(var r in this.layers.hidden){var o=this.layers.hidden[r].neurons();for(var n in o)t.push({neuron:o[n],layer:r})}for(var n in i)t.push({neuron:i[n],layer:"output"});return t},t.prototype.inputs=function(){return this.layers.input.size},t.prototype.outputs=function(){return this.layers.output.size},t.prototype.set=function(t){this.layers=t,this.optimized&&this.optimized.reset()},t.prototype.setOptimize=function(t){this.restore(),this.optimized&&this.optimized.reset(),this.optimized=t?null:!1},t.prototype.toJSON=function(t){this.restore();var e=this.neurons(),i=[],n=[],o={};for(var a in e){var s=e[a].neuron;o[s.ID]=a;var h={trace:{elegibility:{},extended:{}},state:s.state,old:s.old,activation:s.activation,bias:s.bias,layer:e[a].layer,squash:null};h.squash=s.squash==r.LOGISTIC?"LOGISTIC":s.squash==r.TANH?"TANH":s.squash==r.IDENTITY?"IDENTITY":s.squash==r.HLIM?"HLIM":null,i.push(h)}if(!t)for(var a in i){var c=i[a];for(var u in s.trace.elegibility)c.trace.elegibility[u]=s.trace.elegibility[u];for(var p in s.trace.extended){c.trace.extended[p]={};for(var u in s.trace.extended[p])c.trace.extended[o[p]][u]=s.trace.extended[p][u]}}for(var a in e){var s=e[a].neuron;for(var l in s.connections.projected){var f=s.connections.projected[l];n.push({from:o[f.from.ID],to:o[f.to.ID],weight:f.weight,gater:f.gater?o[f.gater.ID]:null})}s.selfconnected()&&n.push({from:o[s.ID],to:o[s.ID],weight:s.selfconnection.weight,gater:s.selfconnection.gater?o[s.selfconnection.gater.ID]:null})}return{neurons:i,connections:n}},t.prototype.toDot=function(t){var e="digraph nn {\n    rankdir = BT\n",i=[this.layers.input].concat(this.layers.hidden,this.layers.output);for(var n in i)for(var r in i[n].connectedto){var o=i[n].connectedto[r],a=o.to,s=o.size,h=i.indexOf(i[n]),c=i.indexOf(a);if(t){if(o.gatedfrom.length){var u="fake"+h+"_"+c;e+="    "+u+' [label = "", shape = point, width = 0.01, height = 0.01]\n',e+="    "+h+" -> "+u+" [label = "+s+", arrowhead = none]\n",e+="    "+u+" -> "+c+"\n"}else e+="    "+h+" -> "+c+" [label = "+s+"]\n";for(var p in o.gatedfrom){var l=o.gatedfrom[p].layer,f=(o.gatedfrom[p].type,i.indexOf(l));e+="    "+f+" -> "+u+" [color = blue]\n"}}else{e+="    "+h+" -> "+c+" [label = "+s+"]\n";for(var p in o.gatedfrom){var l=o.gatedfrom[p].layer,f=(o.gatedfrom[p].type,i.indexOf(l));e+="    "+f+" -> "+c+" [color = blue]\n"}}}return e+="}\n",{code:e,link:"https://chart.googleapis.com/chart?chl="+escape(e.replace("/ /g","+"))+"&cht=gv"}},t.prototype.standalone=function(){this.optimized||this.optimize();var t=this.optimized.data,e="function (input) {\n";for(var i in t.inputs)e+="F["+t.inputs[i]+"] = input["+i+"];\n";for(var n in t.activate)for(var r in t.activate[n])e+=t.activate[n][r]+"\n";e+="var output = [];\n";for(var i in t.outputs)e+="output["+i+"] = F["+t.outputs[i]+"];\n";e+="return output;\n}";var o=e.match(/F\[(\d+)\]/g),a=0,s={};for(var h in o){var c=o[h].match(/\d+/)[0];c in s||(s[c]=a++)}var u="F = {\n";for(var i in s)u+=s[i]+": "+this.optimized.memory[i]+",\n";return u=u.substring(0,u.length-2)+"\n};\n",u="var run = "+e.replace(/F\[(\d+)]/g,function(t){return"F["+s[t.match(/\d+/)[0]]+"]"}).replace("{\n","{\n"+u)+";\n",u+="return run",new Function(u)()},t.prototype.worker=function(){this.optimized||this.optimize();var t="var inputs = "+this.optimized.data.inputs.length+";\n";t+="var outputs = "+this.optimized.data.outputs.length+";\n",t+="var F = null;\n",t+="var activate = "+this.optimized.activate.toString()+";\n",t+="var propagate = "+this.optimized.propagate.toString()+";\n",t+="onmessage = function(e){\n",t+="F = e.data.memoryBuffer;\n",t+="if (e.data.action == 'activate'){\n",t+="if (e.data.input.length == inputs){\n",t+="postMessage( { action: 'activate', output: activate(e.data.input), memoryBuffer: F }, [F.buffer]);\n",t+="}\n}\nelse if (e.data.action == 'propagate'){\n",t+="propagate(e.data.rate, e.data.target);\n",t+="postMessage({ action: 'propagate', memoryBuffer: F }, [F.buffer]);\n",t+="}\n}\n";var e=new Blob([t]),i=window.URL.createObjectURL(e);return new Worker(i)},t.prototype.clone=function(e){return t.fromJSON(this.toJSON(e))},t.fromJSON=function(e){var i=[],a={input:new n.Layer(0),hidden:[],output:new n.Layer(0)};for(var s in e.neurons){var h=e.neurons[s],c=new o.Neuron;c.trace.elegibility=h.trace.elegibility,c.trace.extended=h.trace.extended,c.state=h.state,c.old=h.old,c.activation=h.activation,c.bias=h.bias,c.squash=h.squash in r?r[h.squash]:r.LOGISTIC,i.push(c),"input"==h.layer?a.input.add(c):"output"==h.layer?a.output.add(c):("undefined"==typeof a.hidden[h.layer]&&(a.hidden[h.layer]=new n.Layer(0)),a.hidden[h.layer].add(c))}for(var s in e.connections){var h=e.connections[s],u=i[h.from],p=i[h.to],l=h.weight,f=i[h.gater],v=u.project(p,l);f&&f.gate(v)}return new t(a)},t}();i.Network=a},{"./layer":7,"./neuron":9,"./squash":11}],9:[function(t,e,i){var n=t("./squash"),r=function(){function t(){this.optimizable=!0,this.ID=t.uid(),this.label=null,this.connections={inputs:{},projected:{},gated:{}},this.error={responsibility:0,projected:0,gated:0},this.trace={elegibility:{},extended:{},influences:{}},this.state=0,this.old=0,this.activation=0,this.selfconnection=new t.Connection(this,this,0),this.squash=n.LOGISTIC,this.neighboors={},this.bias=.2*Math.random()-.1,this.derivative=0}return t.prototype.readIncommingConnections=function(t){if("undefined"!=typeof t)return this.activation=t,this.derivative=0,this.bias=0,this.activation;this.old=this.state,this.state=this.selfconnection.gain*this.selfconnection.weight*this.state+this.bias;for(var e in this.connections.inputs){var i=this.connections.inputs[e];this.state+=i.from.activation*i.weight*i.gain}this.activation=this.squash(this.state),this.derivative=this.squash(this.state,!0)},t.prototype.updateTraces=function(){var t=[];for(var e in this.trace.extended){var i=this.trace.extended[e],n=this.neighboors[e],r=n.selfconnection.gater==this?n.old:0;for(var o in this.trace.influences[n.ID])r+=this.trace.influences[n.ID][o].weight*this.trace.influences[n.ID][o].from.activation;t[n.ID]=r}for(var a in this.connections.inputs){var s=this.connections.inputs[a];this.trace.elegibility[s.ID]=this.selfconnection.gain*this.selfconnection.weight*this.trace.elegibility[s.ID]+s.gain*s.from.activation;for(var e in this.trace.extended){var i=this.trace.extended[e],n=this.neighboors[e],r=t[n.ID];i[s.ID]=n.selfconnection.gain*n.selfconnection.weight*i[s.ID]+this.derivative*this.trace.elegibility[s.ID]*r}}for(var h in this.connections.gated)this.connections.gated[h].gain=this.activation},t.prototype.activate=function(t){return this.readIncommingConnections(t),this.updateTraces(),this.activation},t.prototype.propagate=function(t,e){var i=0,n="undefined"!=typeof e&&null!=e;if(n)this.error.responsibility=this.error.projected=e-this.activation;else{for(var r in this.connections.projected){var o=this.connections.projected[r],a=o.to;i+=a.error.responsibility*o.gain*o.weight}this.error.projected=this.derivative*i,i=0;for(var r in this.trace.extended){var a=this.neighboors[r],s=a.selfconnection.gater==this?a.old:0;for(var h in this.trace.influences[r])s+=this.trace.influences[r][h].weight*this.trace.influences[a.ID][h].from.activation;i+=a.error.responsibility*s}this.error.gated=this.derivative*i,this.error.responsibility=this.error.projected+this.error.gated}t=t||.1;for(var r in this.connections.inputs){var c=this.connections.inputs[r],u=this.error.projected*this.trace.elegibility[c.ID];for(var r in this.trace.extended){var a=this.neighboors[r];u+=a.error.responsibility*this.trace.extended[a.ID][c.ID]}c.weight+=t*u}this.bias+=t*this.error.responsibility},t.prototype.project=function(e,i){if(e==this)return this.selfconnection.weight=1,this.selfconnection;var n=this.connected(e);if(n&&"projected"==n.type)return"undefined"!=typeof i&&(n.connection.weight=i),n.connection;var r=new t.Connection(this,e,i);this.connections.projected[r.ID]=r,this.neighboors[e.ID]=e,e.connections.inputs[r.ID]=r,e.trace.elegibility[r.ID]=0;for(var o in e.trace.extended){var a=e.trace.extended[o];a[r.ID]=0}return r},t.prototype.gate=function(t){this.connections.gated[t.ID]=t;var e=t.to;if(!(e.ID in this.trace.extended)){this.neighboors[e.ID]=e;var i=this.trace.extended[e.ID]={};for(var n in this.connections.inputs){var r=this.connections.inputs[n];i[r.ID]=0}}e.ID in this.trace.influences?this.trace.influences[e.ID].push(t):this.trace.influences[e.ID]=[t],t.gater=this},t.prototype.selfconnected=function(){return 0!==this.selfconnection.weight},t.prototype.connected=function(t){var e={type:null,connection:null};if(this==t)return this.selfconnected()?(e.type="selfconnection",e.connection=this.selfconnection,e):null;for(var i in this.connections)for(var n in this.connections[i]){var n=this.connections[i][n];if(n.to==t)return e.type=i,e.connection=n,e;if(n.from==t)return e.type=i,e.connection=n,e}return null},t.prototype.clear=function(){for(var t in this.trace.elegibility)this.trace.elegibility[t]=0;for(var t in this.trace.extended)for(var e in this.trace.extended[t])this.trace.extended[t][e]=0;this.error.responsibility=this.error.projected=this.error.gated=0},t.prototype.reset=function(){this.clear();for(var t in this.connections)for(var e in this.connections[t])this.connections[t][e].weight=.2*Math.random()-.1;this.bias=.2*Math.random()-.1,this.old=this.state=this.activation=0},t.prototype.optimize=function(t,e){t=t||{};var i=[],r=[],o=[],a=t.memory||0,s=t.neurons||1,h=t.inputs||[],c=t.targets||[],u=t.outputs||[],p=t.variables||{},l=t.activation_sentences||[],f=t.trace_sentences||[],v=t.propagation_sentences||[],d=t.layers||{__count:0,__neuron:0},y=function(t){var i=e in d&&t[d.__count];i||(d.__count=t.push([])-1,d[e]=d.__count)};y(l),y(f),y(v);var g=d.__count,m=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i;if(1==t.length)return"target"==t[0]?(i="target_"+c.length,c.push(a)):i=t[0],i in p?p[i]:p[i]={value:0,id:a++};var n=t.length>2;if(n)var r=t.pop();var o=t.shift(),s=t.pop();if(!n)var r=o[s];i=s+"_";for(var h in t)i+=t[h]+"_";return i+=o.ID,i in p?p[i]:p[i]={value:r,id:a++}},w=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=t.pop(),n="";for(var r in t)n+="string"==typeof t[r]?t[r]:"F["+t[r].id+"]";i.push(n+";")},L=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},T=L(this.connections.projected),b=L(this.connections.gated),_="input"==e?!0:L(this.connections.inputs),I="output"==e?!0:T&&b,O=m("rate"),D=m(this,"activation");if(_)h.push(D.id);else{l[g].push(i),f[g].push(r),v[g].push(o);var A=m(this,"old"),x=m(this,"state"),N=m(this,"bias");if(this.selfconnection.gater)var M=m(this.selfconnection,"gain");if(this.selfconnected())var k=m(this.selfconnection,"weight");w(A," = ",x,i),this.selfconnected()?this.selfconnection.gater?w(x," = ",M," * ",k," * ",x," + ",N,i):w(x," = ",k," * ",x," + ",N,i):w(x," = ",N,i);for(var z in this.connections.inputs){var j=this.connections.inputs[z],E=m(j.from,"activation"),S=m(j,"weight");if(j.gater)var F=m(j,"gain");this.connections.inputs[z].gater?w(x," += ",E," * ",S," * ",F,i):w(x," += ",E," * ",S,i)}var P=m(this,"derivative");switch(this.squash){case n.LOGISTIC:w(D," = (1 / (1 + Math.exp(-",x,")))",i),w(P," = ",D," * (1 - ",D,")",i);break;case n.TANH:var q=m("aux"),C=m("aux_2");w(q," = Math.exp(",x,")",i),w(C," = 1 / ",q,i),w(D," = (",q," - ",C,") / (",q," + ",C,")",i),w(P," = 1 - (",D," * ",D,")",i);break;case n.IDENTITY:w(D," = ",x,i),w(P," = 1",i);break;case n.HLIM:w(D," = +(",x," > 0)",i),w(P," = 1",i)}var U=[];for(var R in this.trace.extended){var G=this.trace.extended[R],H=this.neighboors[R],W=m("aux"),V=m(H,"old"),Y=!1;H.selfconnection.gater==this&&(w(W," = ",V,r),Y=!0);for(var B in this.trace.influences[H.ID]){var Q=m(this.trace.influences[H.ID][B],"weight"),X=m(this.trace.influences[H.ID][B].from,"activation");Y?w(W," += ",Q," * ",X,r):(w(W," = ",Q," * ",X,r),Y=!0)}U.push(H.ID),w("influences["+(U.length-1)+"] = ",W,r)}for(var z in this.connections.inputs){var j=this.connections.inputs[z];if(j.gater)var F=m(j,"gain");var E=m(j.from,"activation"),J=m(this,"trace","elegibility",j.ID,this.trace.elegibility[j.ID]);this.selfconnected()?this.selfconnection.gater?j.gater?w(J," = ",M," * ",k," * ",J," + ",F," * ",E,r):w(J," = ",M," * ",k," * ",J," + ",E,r):j.gater?w(J," = ",k," * ",J," + ",F," * ",E,r):w(J," = ",k," * ",J," + ",E,r):j.gater?w(J," = ",F," * ",E,r):w(J," = ",E,r);for(var R in this.trace.extended){var G=this.trace.extended[R],H=this.neighboors[R],W=m("aux"),V=m(H,"old"),J=m(this,"trace","elegibility",j.ID,this.trace.elegibility[j.ID]),G=m(this,"trace","extended",H.ID,j.ID,this.trace.extended[H.ID][j.ID]);if(H.selfconnected())var K=m(H.selfconnection,"weight");if(H.selfconnection.gater)var Z=m(H.selfconnection,"gain");H.selfconnected()?H.selfconnection.gater?w(G," = ",Z," * ",K," * ",G," + ",P," * ",J," * ","influences["+U.indexOf(H.ID)+"]",r):w(G," = ",K," * ",G," + ",P," * ",J," * ","influences["+U.indexOf(H.ID)+"]",r):w(G," = ",P," * ",J," * ","influences["+U.indexOf(H.ID)+"]",r)}}for(var $ in this.connections.gated){var tt=m(this.connections.gated[$],"gain");w(tt," = ",D,i)}}if(!_){var et=m(this,"error","responsibility",this.error.responsibility);if(I){var it=m("target");w(et," = ",it," - ",D,o);for(var R in this.connections.inputs){var j=this.connections.inputs[R],J=m(this,"trace","elegibility",j.ID,this.trace.elegibility[j.ID]),S=m(j,"weight");w(S," += ",O," * (",et," * ",J,")",o)}u.push(D.id)}else if(T||b){if(b){w(et," = 0",o);for(var R in this.connections.projected){var $=this.connections.projected[R],H=$.to,nt=m($,"weight"),rt=m(H,"error","responsibility",H.error.responsibility);if($.gater){var ot=m($,"gain");w(et," += ",rt," * ",ot," * ",nt,o)}else w(et," += ",rt," * ",nt,o)}w(et," *= ",P,o);for(var R in this.connections.inputs){var j=this.connections.inputs[R],J=m(this,"trace","elegibility",j.ID,this.trace.elegibility[j.ID]),S=m(j,"weight");

w(S," += ",O," * (",et," * ",J,")",o)}}else if(T){w(et," = 0",o);for(var R in this.trace.extended){var H=this.neighboors[R],W=m("aux"),V=m(H,"old");H.selfconnection.gater==this?w(W," = ",V,o):w(W," = 0",o);for(var at in this.trace.influences[H.ID]){var $=this.trace.influences[H.ID][at],nt=m($,"weight"),st=m($.from,"activation");w(W," += ",nt," * ",st,o)}var rt=m(H,"error","responsibility",H.error.responsibility);w(et," += ",rt," * ",W,o)}w(et," *= ",P,o);for(var R in this.connections.inputs){var j=this.connections.inputs[R],ht=m("aux");w(ht," = 0",o);for(var R in this.trace.extended){var H=this.neighboors[R],rt=m(H,"error","responsibility",H.error.responsibility),G=m(this,"trace","extended",H.ID,j.ID,this.trace.extended[H.ID][j.ID]);w(ht," += ",rt," * ",G,o)}var S=m(j,"weight");w(S," += ",O," * ",ht,o)}}}else{var ct=m("aux");for(var R in this.connections.projected){var $=this.connections.projected[R],H=$.to,nt=m($,"weight"),rt=m(H,"error","responsibility",H.error.responsibility);if($.gater){var ot=m($,"gain");w(ct," += ",rt," * ",ot," * ",nt,o)}else w(ct," += ",rt," * ",nt,o)}var ut=m(this,"error","projected",this.error.projected);w(ut," = ",P," * ",ct,o),w(ct," = 0",o);for(var R in this.trace.extended){var H=this.neighboors[R],W=m("aux_2"),V=m(H,"old");H.selfconnection.gater==this?w(W," = ",V,o):w(W," = 0",o);for(var at in this.trace.influences[H.ID]){var $=this.trace.influences[H.ID][at],nt=m($,"weight"),st=m($.from,"activation");w(W," += ",nt," * ",st,o)}var rt=m(H,"error","responsibility",H.error.responsibility);w(ct," += ",rt," * ",W,o)}var pt=m(this,"error","gated",this.error.gated);w(pt," = ",P," * ",ct,o),w(et," = ",ut," + ",pt,o);for(var R in this.connections.inputs){var j=this.connections.inputs[R],ht=m("aux"),J=m(this,"trace","elegibility",j.ID,this.trace.elegibility[j.ID]);w(ht," = ",ut," * ",J,o);for(var R in this.trace.extended){var H=this.neighboors[R],rt=m(H,"error","responsibility",H.error.responsibility),G=m(this,"trace","extended",H.ID,j.ID,this.trace.extended[H.ID][j.ID]);w(ht," += ",rt," * ",G,o)}var S=m(j,"weight");w(S," += ",O," * ",ht,o)}}w(N," += ",O," * ",et,o)}return{memory:a,neurons:s+1,inputs:h,outputs:u,targets:c,variables:p,activation_sentences:l,trace_sentences:f,propagation_sentences:v,layers:d}},t}();i.Neuron=r;var r;!function(t){function e(){return t.neuronQty++}function i(){return{neurons:t.neuronQty,connections:n.connectionQty}}var n=function(){function t(e,i,n){if(this.ID=t.uid(),this.gain=1,this.weight=0,this.gater=null,!e||!i)throw"Connection Error: Invalid neurons";this.from=e,this.to=i,this.weight="undefined"==typeof n||isNaN(n)?.2*Math.random()-.1:n}return t}();t.Connection=n,t.neuronQty=0,t.uid=e,t.quantity=i}(r=i.Neuron||(i.Neuron={}));var r;!function(t){var e;!function(t){function e(){return t.connectionQty++}t.connectionQty=0,t.uid=e}(e=t.Connection||(t.Connection={}))}(r=i.Neuron||(i.Neuron={}))},{"./squash":11}],10:[function(t,e,i){var n=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},r=t("./layer"),o=t("./squash"),a=t("./utils"),s=a.Utils,h=function(t){function e(e,i){t.call(this,e,i),this.optimizable=!1;for(var n=0;n<this.list.length;n++)this.list[n].squash=o.IDENTITY}return n(e,t),e.prototype.activate=function(t){this.currentActivation.length!=this.list.length&&(this.currentActivation=new Float64Array(this.list.length));var e=0,i=null;if("undefined"!=typeof t){if(t.length!=this.size)throw"INPUT size and LAYER size must be the same to activate!";s.softMax(t);for(var n in this.list)this.list[n].readIncommingConnections(t[n]),(null===i||this.list[n].activation>i)&&(i=this.list[n].activation)}else for(var n in this.list)this.list[n].readIncommingConnections(),(null===i||this.list[n].activation>i)&&(i=this.list[n].activation);for(var r=0;r<this.currentActivation.length;r++)e+=this.list[r].activation=Math.exp(this.list[r].activation-i);for(var r=0;r<this.currentActivation.length;r++){var o=this.list[r].activation/e;this.list[r].activation=this.currentActivation[r]=o,this.list[r].derivative=o*(1-o),this.list[r].updateTraces()}return this.currentActivation},e.NormalizeConnectionWeights=function(t){for(var e=0,i=0;i<t.list.length;i++)e+=t.list[i].weight=Math.exp(t.list[i].weight);for(var i=0;i<t.list.length;i++)t.list[i].weight/=e},e}(r.Layer);i.SoftMaxLayer=h},{"./layer":7,"./squash":11,"./utils":14}],11:[function(t,e,i){function n(t,e){if(e){var i=n(t);return i*(1-i)}return 1/(1+Math.exp(-t))}function r(t,e){if(e)return 1-Math.pow(r(t),2);var i=Math.exp(t),n=1/i;return(i-n)/(i+n)}function o(t,e){return e?1:t}function a(t,e){return e?1:+(t>0)}function s(t,e){return e?1-1/(1+Math.exp(t)):Math.log(1+Math.exp(t))}function h(t,e){return Math.exp(t)}i.LOGISTIC=n,i.TANH=r,i.IDENTITY=o,i.HLIM=a,i.SOFTPLUS=s,i.EXP=h},{}],12:[function(t,e,i){var n,r=t("./network"),o=t("./layer"),a=t("./neuron"),s=t("./trainer"),h=t("./architect"),c=t("./squash"),u=t("./utils");!function(t){function e(){return window.synaptic=i,t}var i="undefined"!=typeof window&&window&&window.Synaptic;t.ninja=e,t.Neuron=a.Neuron,t.Layer=o.Layer,t.Network=r.Network,t.Trainer=s.Trainer,t.Squash=c,t.Architect=h,t.Utils=u.Utils}(n||(n={})),"undefined"!=typeof window&&(window.synaptic=n),e.exports=n},{"./architect":1,"./layer":7,"./network":8,"./neuron":9,"./squash":11,"./trainer":13,"./utils":14}],13:[function(t,e,i){var n=function(){function t(e,i){this.rate=.2,this.iterations=1e5,this.error=.005,i=i||{},this.network=e,this.rate=i.rate||.2,this.iterations=i.iterations||1e5,this.error=i.error||.005,this.cost=i.cost||t.cost.CROSS_ENTROPY}return t.prototype.train=function(t,e){function i(t){for(var e,i,n=t.length;n;e=Math.floor(Math.random()*n),i=t[--n],t[n]=t[e],t[e]=i);return t}var n,r,o,a,s=1,h=0,c=0,u=!1,p=Date.now();for(e&&(e.shuffle,e.iterations&&(this.iterations=e.iterations),e.error&&(this.error=e.error),e.rate&&(this.rate=e.rate),e.cost&&(this.cost=e.cost),e.schedule&&(this.schedule=e.schedule),e.customLog&&(console.log("Deprecated: use schedule instead of customLog"),this.schedule=e.customLog)),a=this.rate,Array.isArray(this.rate)&&(c=Math.floor(this.iterations/this.rate.length));!u&&h<this.iterations&&s>this.error;){if(s=0,c>0){var l=Math.floor(h/c);a=this.rate[l]}for(var f in t)n=t[f].input,o=t[f].output,r=this.network.activate(n),this.network.propagate(a,o),s+=this.cost(o,r);h++,s/=t.length,e&&(this.schedule&&this.schedule.every&&h%this.schedule.every==0?u=this.schedule["do"]({error:s,iterations:h,rate:a}):e.log&&h%e.log==0&&console.log("iterations",h,"error",s,"rate",a,"T:",o,"O:",r),e.shuffle&&i(t))}var v={error:s,iterations:h,time:Date.now()-p};return v},t.prototype.workerTrain=function(t,e,i){function n(t){for(var e,i,n=t.length;n;e=Math.floor(Math.random()*n),i=t[--n],t[n]=t[e],t[e]=i);return t}function r(t){v.postMessage({action:"activate",input:t,memoryBuffer:s.network.optimized.memory},[s.network.optimized.memory.buffer])}function o(t){if(u>0){var e=Math.floor(c/u);a=this.rate[e]}v.postMessage({action:"propagate",target:t,rate:a,memoryBuffer:s.network.optimized.memory},[s.network.optimized.memory.buffer])}var a,s=this,h=1,c=0,u=0,p=t.length,l=!1,f=Date.now();i&&(i.shuffle,i.iterations&&(this.iterations=i.iterations),i.error&&(this.error=i.error),i.rate&&(this.rate=i.rate),i.cost&&(this.cost=i.cost),i.schedule&&(this.schedule=i.schedule),i.customLog&&console.log("Deprecated: use schedule instead of customLog"),this.schedule=i.customLog),a=this.rate,Array.isArray(this.rate)&&(u=Math.floor(this.iterations/this.rate.length));var v=this.network.worker();v.onmessage=function(a){s.network.optimized.ownership(a.data.memoryBuffer),"propagate"==a.data.action&&(d>=p?(d=0,c++,h/=t.length,i&&(this.schedule&&this.schedule.every&&c%this.schedule.every==0?l=this.schedule["do"]({error:h,iterations:c}):i.log&&c%i.log==0&&console.log("iterations",c,"error",h),i.shuffle&&n(t)),!l&&c<s.iterations&&h>s.error?r(t[d].input):e({error:h,iterations:c,time:Date.now()-f}),h=0):r(t[d].input)),"activate"==a.data.action&&(h+=s.cost(t[d].output,a.data.output),o(t[d].output),d++)};var d=0,c=0;r(t[d].input)},t.prototype.XOR=function(e){if(2!=this.network.inputs()||1!=this.network.outputs())throw"Error: Incompatible network (2 inputs, 1 output)";var i={iterations:1e5,log:!1,shuffle:!0,cost:t.cost.MSE};if(e)for(var n in e)i[n]=e[n];return this.train([{input:[0,0],output:[0]},{input:[1,0],output:[1]},{input:[0,1],output:[1]},{input:[1,1],output:[0]}],i)},t.prototype.DSR=function(t){t=t||{};for(var e=t.targets||[2,4,7,8],i=t.distractors||[3,5,6,9],n=t.prompts||[0,1],r=t.length||24,o=t.success||.95,a=t.iterations||1e5,s=t.rate||.1,h=t.log||0,c=t.schedule||{},u=0,p=0,l=0,f=p=u=k=l=0,v=1,d=e.length+i.length+n.length,y=function(t,e){var i=Math.random()*t|0,n=!1;for(var r in e)i==e[r]&&(n=!0);return n?y(t,e):i},g=function(t,e){for(var i in t)if(Math.round(t[i])!=e[i])return!1;return!0},m=Date.now();a>f&&(o>l||f%1e3!=0);){var w=[],L=r-n.length;for(p=0;L>p;p++){var T=Math.random()*i.length|0;w.push(i[T])}var b=[],_=[];for(p=0;p<n.length;p++)b.push(Math.random()*e.length|0),_.push(y(L,_));for(_=_.sort(),p=0;p<n.length;p++)w[_[p]]=e[b[p]],w.push(n[p]);var I,O=I=0;for(v=0,p=0;r>p;p++){var D=[];for(k=0;d>k;k++)D[k]=0;D[w[p]]=1;var A=[];for(k=0;k<e.length;k++)A[k]=0;if(p>=L){var x=p-L;A[b[x]]=1}var N=this.network.activate(D);g(N,A)?L>p?I++:O++:this.network.propagate(s,A);var M=0;for(var k in N)M+=Math.pow(A[k]-N[k],2);v+=M/this.network.outputs(),I+O==r&&u++}f%1e3==0&&(u=0),f++;var z=f%1e3;z=0==z?1e3:z,l=u/z,v/=r,h&&f%h==0&&console.log("iterations:",f," success:",l," correct:",u," time:",Date.now()-m," error:",v),c["do"]&&c.every&&f%c.every==0&&c["do"]({iterations:f,success:l,error:v,time:Date.now()-m,correct:u})}return{iterations:f,success:l,error:v,time:Date.now()-m}},t.prototype.ERG=function(t){t=t||{};var e=t.iterations||15e4,i=t.error||.05,n=t.rate||.1,r=t.log||500,o=function(){this.paths=[]};o.prototype={connect:function(t,e){return this.paths.push({node:t,value:e}),this},any:function(){if(0==this.paths.length)return!1;var t=Math.random()*this.paths.length|0;return this.paths[t]},test:function(t){for(var e in this.paths)if(this.paths[e].value==t)return this.paths[e];return!1}};for(var a=function(){var t=new o,e=(new o).connect(t,"E"),i=(new o).connect(e,"S"),n=(new o).connect(e,"V").connect(i,"P"),r=(new o).connect(i,"X");r.connect(r,"S");var a=(new o).connect(n,"V");a.connect(a,"T"),i.connect(a,"X");var s=(new o).connect(r,"T").connect(a,"P"),h=(new o).connect(s,"B");return{input:h,output:t}},s=function(){var t=a(),e=a(),i=new o,n=(new o).connect(i,"E");t.output.connect(n,"T"),e.output.connect(n,"P");var r=(new o).connect(t.input,"P").connect(e.input,"T"),s=(new o).connect(r,"B");return{input:s,output:i}},h=function(){for(var t=s().input,e=t.any(),i="";e;)i+=e.value,e=e.node.any();return i},c=function(t){for(var e=s().input,i=0,n=t.charAt(i);i<t.length;){var r=e.test(n);if(!r)return!1;e=r.node,n=t.charAt(++i)}return!0},u=function(t,e){var i=0,n=-1,r=0,o=-1;for(var a in t)t[a]>i&&(i=t[a],n=a),e[a]>r&&(r=e[a],o=a);return n!=o},p=0,l=1,f={B:0,P:1,T:2,X:3,S:4,E:5},v=Date.now();e>p&&l>i;){var d=0;l=0;for(var y=h(),g=y.charAt(d),m=y.charAt(d+1);d<y.length-1;){for(var w=[],L=[],T=0;6>T;T++)w[T]=0,L[T]=0;w[f[g]]=1,L[f[m]]=1;var b=this.network.activate(w);u(b,L)&&this.network.propagate(n,L),g=y.charAt(++d),m=y.charAt(d+1);var _=0;for(var I in b)_+=Math.pow(L[I]-b[I],2);_/=b.length,l+=_}l/=y.length,p++,p%r==0&&console.log("iterations:",p," time:",Date.now()-v," error:",l)}return{iterations:p,error:l,time:Date.now()-v,test:c,generate:h}},t}();i.Trainer=n;var n;!function(t){t.cost={CROSS_ENTROPY:function(t,e){var i=0;for(var n in e)i-=t[n]*Math.log(e[n]+1e-15)+(1-t[n])*Math.log(1+1e-15-e[n]);return i},CROSS_ENTROPY_SOFTMAX:function(t,e){var i=0;for(var n in e)i-=t[n]*Math.log(e[n]+1e-15);return i},MSE:function(t,e){var i=0;for(var n in e)i+=Math.pow(t[n]-e[n],2);return i/e.length}}}(n=i.Trainer||(i.Trainer={}))},{}],14:[function(t,e,i){var n=function(){function t(){}return t.softMax=function(t){if(!t.length)return t;for(var e=0,i=t[0],n=0;n<t.length;n++)t[n]<i&&(i=t[n]);for(var n=0;n<t.length;n++)t[n]=Math.exp(t[n]-i),e+=t[n];for(var n=0;n<t.length;n++)t[n]/=e;return t},t.softMaxDerivative=function(t){if(!t.length)return t;for(var e=0,i=0;i<t.length;i++)t[i]=Math.exp(t[i]),e+=t[i];for(var i=0;i<t.length;i++){var n=t[i]/=e;t[i]=n*(1-n)}return t},t.softMaxReinforcement=function(t,e){if(void 0===e&&(e=1),!t.length)return t;e=e||1;for(var i=0,n=0;n<t.length;n++)t[n]=Math.exp(t[n]/e),i+=t[n];if(0!=i)for(var n=0;n<t.length;n++)t[n]/=i;else for(var r=1/t.length,n=0;n<t.length;n++)t[n]=r;return t},t.getCosineSimilarity=function(t,e){for(var i=0,n=0,r=0,o=0;o<t.length;o++)i+=t[o]*e[o],n+=t[o]*t[o],r+=e[o]*e[o];return i/(Math.sqrt(n)*Math.sqrt(r)+5e-5)},t.interpolateArray=function(t,e,i){for(var n=1-i,r=0;r<t.length;r++)t[r]=t[r]*i+n*e[r];return t},t.sharpArray=function(t,e,i){for(var n=0,r=0;r<e.length;r++)e[r]=Math.pow(e[r],i),n+=e[r];if(0!=n)for(var r=0;r<e.length;r++)t[r]=e[r]/n;else for(var o=1/e.length,r=0;r<e.length;r++)t[r]=o},t.scalarShifting=function(t,e){var i=new Float64Array(t.length),n=new Float64Array(t.length),r=0|e,o=e-r;i[r%i.length]=1-o,i[(r+1)%i.length]=o;for(var a=0;a<n.length;a++){for(var s=0,h=0;h<n.length;h++)s+=0>a-h?t[h]*i[i.length-Math.abs(a-h)]:t[h]*i[(a-h)%i.length];n[a]=s}return n},t.normalizeShift=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i];for(var n=0;n<t.length;n++)t[n]/=e},t.vectorInvertedShifting=function(e,i){for(var n=new Float64Array(e.length),r=0|-((i.length-1)/2),o=t.transformationMatrixCache[e.length]||(t.transformationMatrixCache[e.length]=t.buildCirculantMatrix(e.length)),a=0;a<e.length;a++)for(var s=0;s<e.length;s++){for(var h=0,c=0;c<i.length;c++){for(var u=a-s+r+c;0>u;)u+=e.length;u%=e.length,h+=e[o[s][u]]*i[c]}n[a]=h}e.set(n)},t.initRandomSoftmaxArray=function(e){for(var i=0;i<e.length;i++)e[i]=Math.random();t.softMax(e)},t.buildCirculantMatrix=function(t,e){void 0===e&&(e=0);for(var i=[],n=0;t>n;n++){var r=new Float64Array(t);i.push(r);for(var o=0;t>o;o++)r[o]=(n+o)%t}return i},t.transformationMatrixCache={},t}();i.Utils=n},{}]},{},[12]);var synaptic = synaptic || Synaptic;var Neuron = synaptic.Neuron, Layer = synaptic.Layer, Network = synaptic.Network, Trainer = synaptic.Trainer, Architect = synaptic.Architect;